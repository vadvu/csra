---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# csra

<!-- badges: start -->
<!-- badges: end -->


csra is a package with functions used by [CSRA](https://social.hse.ru/mr/) staff analyzing political events

## Installation

You can install the development version of csra from [GitHub](https://github.com/) with:

``` r

# install.packages("devtools")
devtools::install_github("vadvu/csra")

```

## Example

This is a basic example which shows you how the main function "equalparts" works:

```{r example 1}
library(csra)
data <- data("dataex") #it's an example panel data that you can use

#Now let's try to analyze how VDEM democracy index affects revolutionary situations
equalparts(
  data = datex, #our data
  independent = 'VDEM_v2x_polyarchy', #independent var
  lag_independent = T, #Should it be lagged? Yea because political regime can change gramatically during revolutionary year
  lag_code = "iso3", #by what unit lag is realized
  lead = T, #due to specific of data (in the top we have earlier data - 2019, 2018, 2017, ...) lead should be used. Otherwise, False is needed
  dependent = 'NVC_1.3_NONVIOL', #dependent var
  n = 6, #number of equal parts. If n = 10, it is decile analysis, 4 - quartile analysis and etc
  bar_or_scatter = 'scatter', #plot type, scatter is more powerful
  regline = TRUE, #linear regression line
  return_data = FALSE, #we want to see plot, so we do not need data
  conf_bars = TRUE, #95%CI
  range_bars = FALSE, #range (max-min) of independent var in each unit (for ex., decile)
  save_plot = FALSE #we do not want to save plot, so its False
)
```

Plot that is returned by default can be easily changed by ggplot2 syntax. Just save function output and add to it ggplot2 blocks: 

```{r example2}
library(csra)
library(ggplot2)
data <- data("dataex")

plot <- equalparts(
  data = datex,
  independent = 'VDEM_v2x_polyarchy',
  lag_independent = T,
  lag_code = "iso3",
  lead = T,
  dependent = 'NVC_1.3_NONVIOL',
  n = 6,
  bar_or_scatter = 'scatter',
  regline = TRUE,
  return_data = FALSE,
  conf_bars = TRUE,
  range_bars = FALSE,
  save_plot = FALSE
)

# for ex., change axis names and theme
plot + xlab("x var name") + ylab("y var name") + theme_grey()

```

Also table with results can be returned, just set return_data = TRUE:

```{r example3}
library(csra)
library(ggplot2)
data <- data("dataex")

equalparts(
  data = datex,
  independent = 'VDEM_v2x_polyarchy',
  lag_independent = T,
  lag_code = "iso3",
  lead = T,
  dependent = 'NVC_1.3_NONVIOL',
  n = 6,
  bar_or_scatter = 'scatter',
  regline = TRUE,
  return_data = TRUE, #here
  conf_bars = TRUE,
  range_bars = FALSE,
  save_plot = FALSE
)
```

Another function that is in DEMO stage now - U_shape_test. It is needed to detect hump-shaped form of links. 
Now only rare events logistic model has been implemented now (but the logic is suit for all glm)


```{r example4}
library(csra)
data <- data("dataex")

U_shape_test(
  data = datex, #our data
  dep_var = "NVC_1.3_NONVIOL", #dependent variable
  ind_var = "VDEM_v2x_polyarchy_lag", #independent var
  control_vars = c("UN_Total_Population_log", "UN_Median_Age"), #control vars
  boot = TRUE, #bootstrap for middle point analysis
  vcov_type = "HC", #type of SE
  n = 10, #number of bootstraps. Too small in this example
  save_plot = FALSE, #we do not need to save plot
  save_table = FALSE #we do not need to save regression table
)
```






