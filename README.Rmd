
---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# csra

<!-- badges: start -->
<!-- badges: end -->


csra is a package with functions used by [CSRA](https://social.hse.ru/mr/) staff analyzing political events

## Installation

You can install the development version of csra from [GitHub](https://github.com/) with:

``` r

# install.packages("devtools")
devtools::install_github("vadvu/csra")

```

## Example 1

This is a basic example which shows you how the main function "equalparts" works:

```{r example 1}
library(csra)
data <- data("dataex") #it's an example panel data that you can use

#Now let's try to analyze how VDEM democracy index affects revolutionary situations
equalparts(
  data = datex, #our data
  independent = 'VDEM_v2x_polyarchy', #independent var
  lag_independent = T, #Should it be lagged? Yea because political regime can change gramatically during revolutionary year
  lag_code = "iso3", #by what unit lag is realized
  lead = T, #due to specific of data (in the top we have earlier data - 2019, 2018, 2017, ...) lead should be used. Otherwise, False is needed
  dependent = 'NVC_1.3_NONVIOL', #dependent var
  n = 6, #number of equal parts. If n = 10, it is decile analysis, 4 - quartile analysis and etc
  bar_or_scatter = 'scatter', #plot type, scatter is more powerful
  regline = TRUE, #linear regression line
  return_data = FALSE, #we want to see plot, so we do not need data
  conf_bars = TRUE, #95%CI
  range_bars = FALSE, #range (max-min) of independent var in each unit (for ex., decile)
  save_plot = FALSE #we do not want to save plot, so its False
)
```

Plot that is returned by default can be easily changed by ggplot2 syntax. Just save function output and add to it ggplot2 blocks: 

```{r example2}
library(csra)
library(ggplot2)
data <- data("dataex")

plot <- equalparts(
  data = datex,
  independent = 'VDEM_v2x_polyarchy',
  lag_independent = T,
  lag_code = "iso3",
  lead = T,
  dependent = 'NVC_1.3_NONVIOL',
  n = 6,
  bar_or_scatter = 'scatter',
  regline = TRUE,
  return_data = FALSE,
  conf_bars = TRUE,
  range_bars = FALSE,
  save_plot = FALSE
)

# for ex., change axis names and theme
plot + xlab("x var name") + ylab("y var name") + theme_grey()

```

Also table with results can be returned, just set return_data = TRUE:

```{r example3}
library(csra)
library(ggplot2)
data <- data("dataex")

equalparts(
  data = datex,
  independent = 'VDEM_v2x_polyarchy',
  lag_independent = T,
  lag_code = "iso3",
  lead = T,
  dependent = 'NVC_1.3_NONVIOL',
  n = 6,
  bar_or_scatter = 'scatter',
  regline = TRUE,
  return_data = TRUE, #here
  conf_bars = TRUE,
  range_bars = FALSE,
  save_plot = FALSE
)
```

## Example 2

Another function (in the DEMO stage) is the U_shape_test, which aims to detect hump-shaped forms of links. Currently, only a rare events logistic model has been implemented, although the logic is suitable for all GLMs. 
This method operates in the following way:
1. The full model is estimated on a sample with a polynomial term. 
2. Divide the sample into two subsamples - the first being below the midpoint (which is identified as the vertex of the parabola from the polynomial term), and the second being above it. 
3. Estimate two models on the two subsamples. A hump-shaped relationship assumes that there is both an ascending and a descending part. So, in order to test a hump, it is necessary to have significant positive and negative coefficients on the first and second subsample respectively.
4. A semiparametric model is estimated without assumptions about the form of the link. The GAM method is used for this purpose. The variable of interest is modelled as a smooth term using cubic splines while other variables are modelled using parametric regressions. 
5. ANOVA test between the model with a polynomial term (1st step) and GAM model (4th step). This test is needed to identify whether the polynomial term provides a better or not worse fit than the link found by the GAM splines. If p > 0.1, then the polynomial is considered a good approximation. 
6. This is the final stage. 
If the polynomial term is significant (1st stage) and there are significant opposite signs on subsamples (2nd stage), and the GAM term is significant in terms of EDF significance (4th stage), and the ANOVA test's p-value is greater than 0.1 (5th stage), then there exists a hump-shaped or U-shaped link between the variables. In this case, the polynomial term is suitable for approximating such a relationship. 

```{r example4}
library(csra)
data <- data("dataex")

U_shape_test(
  data = datex, #our data
  dep_var = "NVC_1.3_NONVIOL", #dependent variable
  ind_var = "VDEM_v2x_polyarchy_lag", #independent var
  control_vars = c("UN_Total_Population_log", "UN_Median_Age"), #control vars
  boot = FALSE, #bootstrap for middle point analysis. Is not used in the example
  vcov_type = "HC", #type of SE
  save_plot = FALSE, #we do not need to save plot
  save_table = FALSE #we do not need to save regression table
)
```






